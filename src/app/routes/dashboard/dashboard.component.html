<page-header [action]="phActionTpl">
  <ng-template #phActionTpl> </ng-template>
  <p>欢迎您：{{loadUser.user.bname}} -> {{loadUser.user.name}} （{{loadUser.user.unitName}}）</p>
</page-header>
<div nz-row *ngFor="let divData of listOfData">
  <!-- 填报员 -->
  <div nz-row [nzGutter]="8" *ngIf="!(loadUser.user.unitNo==='xnzj'||loadUser.user.unitNo==='xwzj')">
    <div nz-col [nzSpan]="10">
      <nz-card nzTitle="【{{divData.appName}}】" style="background-color: rgb(252, 251, 228);border-radius: 10px;">
        <p style="line-height: 2em">周期：{{ divData.startDate }}至{{ divData.endDate }}</p>
        <p style="line-height: 2em">类别：{{ divData.esType }} &nbsp;&nbsp;&nbsp;
          <button *ngIf="loadUser.user.unitNo==='zxbmtb'" nz-button nzSize="small" nzType="primary"
            style="border: 0em;background: coral;" down-file
            [http-url]="'http://139.224.62.102/assets/'+divData.verIndex+'.pdf'" [file-name]="divData.esName+'.pdf'">
            <i nz-icon nzType="download"></i> 评估指标体系及内涵</button>

          <button *ngIf="loadUser.user.unitNo==='fxtb'" nzSize="small" nz-button nzType="primary"
            style="border: 0em;background: coral;" down-file
            [http-url]="'http://139.224.62.102/assets/'+divData.verIndex+'.pdf'" [file-name]="divData.esName+'.pdf'">
            <i nz-icon nzType="download"></i> 评估指标体系及内涵</button>
        </p>
      </nz-card>
    </div>
    <div nz-col [nzSpan]="14">
      <nz-card nzTitle="当前阶段：数据填报" [nzExtra]="extraTemplate" style="border-radius: 10px;">
        <p style="line-height: 2em">
          阶段周期：{{ divData.startDate }} 至 {{ divData.endDate }}
        </p>
        <p style="line-height: 2em">
          <button *ngIf="divData.isZx" nz-button nzSize="small" nzType="primary" (click)="openDataUp(divData)">
            <i nz-icon nzType="edit"></i>数据填报</button>
          <button *ngIf="!divData.isZx" nz-button nzSize="small" nzType="primary" (click)="openDataUpFx(divData)">
            <i nz-icon nzType="edit"></i>数据填报</button>
          <nz-divider nzType="vertical"></nz-divider>
          <button *ngIf="divData.isZx" nz-button nzSize="small" nzType="primary" (click)="openFileUp(divData)">
            <i nz-icon nzType="upload"></i>材料上传</button>
          <button *ngIf="!divData.isZx" nz-button nzSize="small" nzType="primary" (click)="openFileUpFx(divData)">
            <i nz-icon nzType="upload"></i>材料上传</button>
        </p>
      </nz-card>
      <ng-template #extraTemplate>状态：
        <nz-tag *ngIf="statusStr==='1'" [nzColor]="'#f50'">未填报</nz-tag>
        <nz-tag *ngIf="statusStr==='1'" [nzColor]="'#f50'">未上传</nz-tag>
      </ng-template>
    </div>
  </div>
  <!-- 专家组 -->
  <div nz-row [nzGutter]="8" *ngIf="loadUser.user.unitNo==='xnzj'||loadUser.user.unitNo==='xwzj'">
    <div nz-col [nzSpan]="24">
      <nz-card [nzTitle]="titleTemplate3" style="background-color:#EEE;border-radius: 10px;">

        <div nz-row nzGutter="24" nzAlign="middle" class="little-card">
          <div nz-col nzXs="24" nzMd="8" style="cursor: pointer;">
            <div nz-row nzType="flex" nzAlign="middle" class="bg-magenta text-center rounded-md">
              <div nz-col nzSpan="8" class="p-md text-white">
                <i nz-icon nzType="cloud-download" class="display-2"></i>
              </div>
              <div nz-col nzSpan="16" class="bg-white py-md">
                <p>
                  <button nz-button nzType="primary" style="border: 0em;background: coral;" down-file
                    [http-url]="'http://139.224.62.102/assets/'+divData.verIndex+'.pdf'"
                    [file-name]="divData.appName+'.pdf'">
                    文档下载</button>
                </p>
                <div class="text-grey-dark">点击下载指标体系及内涵</div>
              </div>
            </div>
          </div>
          <!-- 总校评估评审 -->
          <div *ngIf="divData.verIndex.toString().substring(4,6)==='zx'" nz-col nzXs="24" nzMd="8"
            style="cursor: pointer;" (click)="zxZjpsWeb(divData)">
            <div nz-row nzType="flex" nzAlign="middle" class="bg-primary text-center rounded-md">
              <div nz-col nzSpan="8" class="p-md text-white">
                <i nz-icon nzType="solution" class="display-2"></i>
              </div>
              <div nz-col nzSpan="16" class="bg-white py-md">
                <p>
                  <button nz-button nzType="primary" style="border: 0em;background: coral;">
                    在线评审反馈</button>
                </p>
                <div class="text-grey-dark">在线查看数据和材料，打分并反馈意见</div>
              </div>
            </div>
          </div>
          <!-- 分校评估评审 -->
          <div *ngIf="divData.verIndex.toString().substring(4,6)==='fx'" nz-col nzXs="24" nzMd="8"
            style="cursor: pointer;" (click)="fxZjpsWeb(divData)">
            <div nz-row nzType="flex" nzAlign="middle" class="bg-primary text-center rounded-md">
              <div nz-col nzSpan="8" class="p-md text-white">
                <i nz-icon nzType="solution" class="display-2"></i>
              </div>
              <div nz-col nzSpan="16" class="bg-white py-md">
                <p>
                  <button nz-button nzType="primary" style="border: 0em;background: coral;">
                    在线评审反馈</button>
                </p>
                <div class="text-grey-dark">在线查看数据和材料，打分并反馈意见</div>
              </div>
            </div>
          </div>
          <!-- 打包下载 -->
          <div nz-col nzXs="24" nzMd="8" style="cursor: pointer;">
            <div nz-row nzType="flex" nzAlign="middle" class="bg-geekblue text-center rounded-md">
              <div nz-col nzSpan="8" class="p-md text-white">
                <i nz-icon nzType="file-zip" nzTheme="outline"></i>
              </div>
              <div nz-col nzSpan="16" class="bg-white py-md">
                <p>
                  <button nz-button nzType="primary" style="border: 0em;background: coral;">
                    数据和文字材料</button>
                </p>
                <div class="text-grey-dark">离线评审后，登录系统上传评审结果</div>
              </div>
            </div>
          </div>
        </div>
      </nz-card>
      <ng-template #titleTemplate3>
        <span style="font-size:1.1em;color:#333;">评估任务：
          <b>{{divData.appName}} —— {{divData.stepName}}【{{ divData.fromDate.toString().substring(0,10) }}
            至 {{ divData.endDate.toString().substring(0,10) }}】</b>
        </span>
      </ng-template>
    </div>
    <!-- <div nz-col [nzSpan]="16">
      <nz-card [nzTitle]="titleTemplate4" [nzExtra]="extraTemplate"
        style="border-radius: 10px;background-color: rgb(252, 251, 228);">
        <div nz-row nzGutter="24" nzAlign="middle" class="little-card"> 
          <div nz-col [nzSpan]="12">
            <p style="line-height: 2.5em;font-size:1.2em;">
              <i nz-icon nzType="ie-square" nzTheme="fill"></i> 在线评审 <br>

              <i nz-icon nzType="folder-open" nzTheme="fill"></i> 离线评审
            </p>
            <ul nz-list [nzDataSource]="divData.indexInfoList" nzBordered [nzRenderItem]="largeItem">
              <ng-template #largeItem let-item>
                <li nz-list-item [nzActions]="[opAction]" [nzContent]="item.indexName" nzNoFlex></li>
                <ng-template #opAction><a style="color: coral; ">评审>></a></ng-template>
              </ng-template>
            </ul>
          </div>
          <div nz-col [nzSpan]="12" *ngIf="!divData.isZx">
            <p style="line-height: 2.5em;font-size:1.2em;">【按分校评审】

            </p>
            <ul nz-list [nzDataSource]="divData.branchInfoList" nzBordered [nzRenderItem]="largeItem">
              <ng-template #largeItem let-item>
                <li nz-list-item [nzActions]="[opAction]" [nzContent]="item.bname" nzNoFlex></li>
                <ng-template #opAction><a style="color: coral; ">评审>></a></ng-template>
              </ng-template>
            </ul>
          </div>
        </div>
      </nz-card>
      <ng-template #extraTemplate>状态：
        <nz-tag *ngIf="statusStr==='1'" [nzColor]="'#f50'">评审中</nz-tag>
      </ng-template>
      <ng-template #titleTemplate4>
        <span style="font-weight: bold;font-size:1.1em;">
          {{divData.stepName}}【{{ divData.fromDate.toString().substring(0,10) }}
          至 {{ divData.endDate.toString().substring(0,10) }}】</span>
      </ng-template>
    </div> -->
  </div>
</div>
